apply plugin: 'com.android.application'

// El bloque 'ext' fue eliminado, ya que estas versiones ahora están hardcodeadas en 'dependencies'
// o se gestionan por 'variables.gradle' para evitar conflictos.

android {
  namespace "com.neiruzlab.app"
  compileSdk 35

  sourceSets {
    main {
      jniLibs.srcDirs = ['libs'] // Busca librerías nativas en la carpeta 'libs'
    }
  }

  defaultConfig {
    applicationId "com.neiruzlab.app"
    minSdkVersion 23
    targetSdkVersion 35
    versionCode 42
    versionName "1.1.4"
    testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    aaptOptions {
      ignoreAssetsPattern '!.svn:!.git:!.ds_store:!*.scc:.*:!CVS:!thumbs.db:!picasa.ini:!*~'
    }
  }

  // CONFIGURACIÓN FORZADA DE ALINEACIÓN DE 16KB (CRÍTICA)
  packagingOptions {
    jniLibs {
      useLegacyPackaging = false // Soluciona la advertencia de 16KB de Play Console
    }
  }

  signingConfigs {
    release {
      storeFile file("release-key.jks")
      storePassword "juliok64"
      keyAlias "my-key-alias"
      keyPassword "juliok64"
    }
  }

  buildTypes {
    release {
      signingConfig signingConfigs.release
      minifyEnabled true
      shrinkResources true
      proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'

      ndk {
        debugSymbolLevel 'FULL'
      }
    }
  }

}

repositories {
  google()
  mavenCentral()
}


dependencies {
  implementation fileTree(include: ['*.jar'], dir: 'libs')

  // Versiones actualizadas (hardcodeadas para asegurar que se usan)
  implementation "androidx.appcompat:appcompat:1.7.1"
  implementation "androidx.coordinatorlayout:coordinatorlayout:1.3.0"

  // Dependencias usando variables
  implementation "androidx.core:core-splashscreen:$coreSplashScreenVersion"
  implementation project(':capacitor-android')
  testImplementation "junit:junit:$junitVersion"

  // Versiones actualizadas (hardcodeadas para asegurar que se usan)
  androidTestImplementation "androidx.test.ext:junit:1.3.0"
  androidTestImplementation "androidx.test.espresso:espresso-core:3.7.0"

  implementation project(':capacitor-cordova-android-plugins')

  // Versión actualizada de Google Play Services Ads
  implementation ('com.google.android.gms:play-services-ads:24.7.0')
}

apply from: 'capacitor.build.gradle'

// ⚠️ ÚLTIMO PASO PARA CORREGIR flatDir ⚠️
// El problema persiste porque un PLUGIN externo inyecta 'flatDir' después de este archivo.
// LA CORRECCIÓN FINAL DEBE IR EN EL ARCHIVO android/build.gradle (nivel raíz).

// Si el error persiste, mueve el siguiente bloque (comentado) al final del archivo
// android/build.gradle (el que está en la carpeta raíz 'android/'):
/*
allprojects {
    repositories {
        google()
        mavenCentral()
    }
}
*/
